<%- include('../partials/head') %> <%- include('../partials/header', { title:
pagetitle }) %>

<!-- MAIN CONTENT -->
<div class="main">
  <div class="main-content dashboard">
    <div class="row">
      <!-- Total Projects Card -->
      <div class="col-6 col-xl-12 col-sm-12">
        <div class="box">
          <div class="box-body d-flex pb-0">
            <div class="me-auto">
              <h5 class="box-title">Total de Projetos</h5>
              <h4 class="mb-0 font-wb fs-30 mt-23"><%= totalProjects %></h4>
            </div>
          </div>
        </div>
      </div>

      <!-- Total Task Done Card (sem barra) -->
      <div class="col-6 col-xl-12 col-sm-12">
        <div class="box">
          <div class="box-body d-flex pb-0">
            <div class="me-auto">
              <h5 class="box-title">Total de Tarefas Finalizadas</h5>
              <h4 class="mb-0 font-wb fs-30 mt-23"><%= totalCompleted %></h4>
            </div>
          </div>
        </div>
      </div>

      <!-- Total Clients Card (padronizado) -->
      <div class="col-6 col-xl-12 col-sm-12">
        <div class="box">
          <div class="box-body d-flex pb-0">
            <div class="me-auto">
              <h5 class="box-title">Total de Clientes</h5>
              <h4 class="mb-0 font-wb fs-30 mt-23"><%= totalClients %></h4>
            </div>
          </div>
        </div>
      </div>

      <!-- TASK STATUS CHART -->
      <div class="col-12 mt-4">
        <div class="box">
          <div class="box-header">
            <h4 class="box-title">Distribuição das Tarefas por Status</h4>
          </div>
          <div
            class="box-body d-flex justify-content-center align-items-center"
            style="min-height: 220px"
          >
            <canvas
              id="taskStatusChart"
              width="260"
              height="180"
              style="display: block !important"
            ></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- END MAIN CONTENT -->

<div class="overlay"></div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const ctx = document.getElementById("taskStatusChart").getContext("2d");
  new Chart(ctx, {
    type: "doughnut",
    data: {
      labels: ["Pendente", "Em Andamento", "Concluída"],
      datasets: [
        {
          label: "Tarefas",
          data: [
            typeof countPendingTasks !== "undefined" ? countPendingTasks : 0,
            typeof countInProgressTasks !== "undefined"
              ? countInProgressTasks
              : 0,
            typeof countCompletedTasks !== "undefined"
              ? countCompletedTasks
              : 0,
          ],
          backgroundColor: ["#f44336", "#ff9800", "#4caf50"],
          borderWidth: 1,
        },
      ],
    },
    options: {
      responsive: false,
      plugins: {
        legend: {
          position: "bottom",
        },
      },
    },
  });
</script>

<%- include('../partials/footer') %>
